
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../testing/">
      
      
        <link rel="next" href="../getting_started_hcs_wrappers/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>Working with individual images - ez_zarr</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-ez_zarr-to-explore-individual-ome-zarr-images" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ez_zarr" class="md-header__button md-logo" aria-label="ez_zarr" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ez_zarr
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Working with individual images
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ez_zarr" class="md-nav__button md-logo" aria-label="ez_zarr" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ez_zarr
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ome_zarr/" class="md-nav__link">
        OME-Zarr classes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hcs_wrappers/" class="md-nav__link">
        Legacy classes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Utilities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plotting/" class="md-nav__link">
        Plotting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        Unit tests
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Working with individual images
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started_hcs_wrappers/" class="md-nav__link">
        Working with HCS plates (legacy classes)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="using-ez_zarr-to-explore-individual-ome-zarr-images">Using <code>ez_zarr</code> to explore individual OME-Zarr images</h1>
<p>Silvia Barbiero, Michael Stadler, Charlotte Soneson</p>
<ul>
<li><a href="#goal">Goal</a></li>
<li><a href="#using-ome_zarr.image-objects">Using <code>ome_zarr.Image</code> objects</a><ul>
<li><a href="#download-example-data">Download example data</a></li>
<li><a href="#load-packages">Load packages</a></li>
<li><a href="#open-ome-zarr-file-set">Open OME-Zarr file set</a></li>
<li><a href="#get-information-from-img">Get information from <code>img</code></a></li>
<li><a href="#extract-a-table-from-the-ome-zarr-image">Extract a table from the OME-Zarr
    image</a></li>
<li><a href="#visualize-the-image">Visualize the image</a></li>
<li><a href="#zoom-in">Zoom in</a></li>
<li><a href="#coordinate-conversions-usually-done-internally">Coordinate conversions (usually done
    internally)</a></li>
<li><a href="#working-with-segmentation-masks">Working with segmentation
    masks</a></li>
<li><a href="#calculations-on-the-image-data">Calculations on the image
    data</a></li>
</ul>
</li>
<li><a href="#working-with-images-with-time-dimension">Working with images with time
    dimension</a></li>
<li><a href="#working-with-multiple-images">Working with multiple images</a></li>
<li><a href="#session-info">Session info</a></li>
</ul>
<h1 id="goal">Goal</h1>
<p>The aim of <code>ez_zarr</code> is to provide easy, high-level access to microscopy
data, stored in OME-Zarr format according to the
<a href="https://ngff.openmicroscopy.org/latest/">NGFF</a> specifications.</p>
<p>In addition to the python package, we also provide an R package that
automatically generates and wraps a python environment with <code>ez_zarr</code>
and all dependencies, available at https://github.com/fmicompbio/ezzarr.</p>
<p>The <code>ome_zarr.Image</code> class represents an individual image and provides
methods to obtain metadata, extract image or label arrays and visualize
these. Below we illustrate the use of <code>ome_zarr.Image</code> objects by
examples.</p>
<h1 id="using-ome_zarrimage-objects">Using <code>ome_zarr.Image</code> objects</h1>
<p>Note: If you prefer to run these examples interactively, you can also
download them as an <a href="https://fmicompbio.github.io/ez_zarr/getting_started_Image.ipynb">ipynb
notebook</a>.</p>
<p>Here are some examples of how you can use <code>ome_zarr.Image</code> objects
defined in <code>ez_zarr</code>:</p>
<h2 id="download-example-data">Download example data</h2>
<p>To run the code below, you will first need to download some image data.
You can do this for example by running the following from a terminal:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Download small Fractal output from Zenodo</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>curl<span class="w"> </span>-o<span class="w"> </span>temp.zip<span class="w"> </span>https://zenodo.org/records/10519143/files/20200812-CardiomyocyteDifferentiation14-Cycle1_mip.zarr.zip
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Unzip and remove the temporary zip file</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>unzip<span class="w"> </span>temp.zip
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>rm<span class="w"> </span>temp.zip
</code></pre></div>
<p>or directly from within a python notebook or session using:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">import</span> <span class="nn">requests</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">import</span> <span class="nn">zipfile</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">import</span> <span class="nn">tempfile</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">import</span> <span class="nn">shutil</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="kn">import</span> <span class="nn">sys</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c1"># for info on data see: https://zenodo.org/records/10257149</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://zenodo.org/records/10519143/files/20200812-CardiomyocyteDifferentiation14-Cycle1_mip.zarr.zip&#39;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="c1"># download</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_zip</span><span class="p">:</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    <span class="n">temp_zip</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="c1"># unzip to current directory</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="s1">&#39;temp.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="c1"># clean up</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;temp.zip&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="load-packages">Load packages</h2>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">color</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="kn">from</span> <span class="nn">ez_zarr</span> <span class="kn">import</span> <span class="n">ome_zarr</span><span class="p">,</span> <span class="n">plotting</span><span class="p">,</span> <span class="n">utils</span>
</code></pre></div>
<h2 id="open-ome-zarr-file-set">Open OME-Zarr file set</h2>
<p>We open a single OME-Zarr image:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">img_directory</span> <span class="o">=</span> <span class="s1">&#39;20200812-CardiomyocyteDifferentiation14-Cycle1_mip.zarr/B/03/0&#39;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">img</span> <span class="o">=</span> <span class="n">ome_zarr</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">img_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cardio-d14&#39;</span><span class="p">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">img</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at .DS_Store is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at empty_well_ROI_table_1_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at empty_well_ROI_table_0_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_well_ROI_table_3_False_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at empty_well_ROI_table_1_False_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_overwrite_True is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_FOV_ROI_table_1_False_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_masked_nuclei_ROI_table_0_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_well_ROI_table_3_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at empty_well_ROI_table_0_False_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_FOV_ROI_table_1_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_masked_nuclei_ROI_table_1_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_overwrite_False is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_well_ROI_table_0_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(

Image cardio-d14
  path: 20200812-CardiomyocyteDifferentiation14-Cycle1_mip.zarr/B/03/0
  n_channels: 1 (DAPI)
  n_pyramid_levels: 5
  pyramid_zyx_scalefactor: [1. 2. 2.]
  full_resolution_zyx_spacing (micrometer): [1.0, 0.1625, 0.1625]
  segmentations: nuclei, empty
  tables (measurements): expected_table_well_ROI_table_0_True_0_0, well_ROI_table, expected_table_well_ROI_table_3_False_0_0, expected_table_masked_nuclei_ROI_table_0_True_0_0, FOV_ROI_table, expected_table_masked_nuclei_ROI_table_1_True_0_0, expected_table_well_ROI_table_3_True_0_0, expected_table_FOV_ROI_table_1_False_0_0, nuclei_ROI_table, nuclei, expected_table_FOV_ROI_table_1_True_0_0
</code></pre></div>
<p><code>img</code> represents a maximum intensity projection of one well from a
high-content screening plate, processed using
<a href="https://fractal-analytics-platform.github.io/">Fractal</a>. In addition to
such images with two spatial dimensions, <code>ez-zarr</code> supports OME-Zarr
images with any number of dimensions, automatically projecting images
with more than two spatial dimensions for plotting.</p>
<p>In <code>img</code>, there are 5 <code>pyramid_levels</code> available (0 to 4), meaning that
in addition to the full resolution data (level 0), we have four more
levels that provide the data in 2-fold lower resolutions (see
<code>pyramid_zyx_scalefactor</code>), for example for faster plotting.</p>
<p>This OME-Zarr image also contains two segmentations (<code>empty</code> and
<code>nuclei</code>), and for one measurements have been extracted and saved in the
table <code>nuclei</code>. In addition, there are some further tables, such as
<code>FOV_ROI_table</code>, which contains the coordinates of the fields of view,
or <code>nuclei_ROI_table</code>, which contains the bounding box coordinates for
the segmented nuclei.</p>
<h2 id="get-information-from-img">Get information from <code>img</code></h2>
<p>You can obtain specific information on the content available in the
image:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># path to the OME-Zarr image</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">img</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>&#39;20200812-CardiomyocyteDifferentiation14-Cycle1_mip.zarr/B/03/0&#39;
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># available channels</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">img</span><span class="o">.</span><span class="n">get_channels</span><span class="p">()</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>[{&#39;color&#39;: &#39;00FFFF&#39;,
  &#39;label&#39;: &#39;DAPI&#39;,
  &#39;wavelength_id&#39;: &#39;A01_C01&#39;,
  &#39;window&#39;: {&#39;end&#39;: 800, &#39;max&#39;: 65535, &#39;min&#39;: 0, &#39;start&#39;: 110}}]
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># available labels</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">img</span><span class="o">.</span><span class="n">get_label_names</span><span class="p">()</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>[&#39;nuclei&#39;, &#39;empty&#39;]
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># available tables</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">img</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">()</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>[&#39;expected_table_well_ROI_table_0_True_0_0&#39;,
 &#39;well_ROI_table&#39;,
 &#39;expected_table_well_ROI_table_3_False_0_0&#39;,
 &#39;expected_table_masked_nuclei_ROI_table_0_True_0_0&#39;,
 &#39;FOV_ROI_table&#39;,
 &#39;expected_table_masked_nuclei_ROI_table_1_True_0_0&#39;,
 &#39;expected_table_well_ROI_table_3_True_0_0&#39;,
 &#39;expected_table_FOV_ROI_table_1_False_0_0&#39;,
 &#39;nuclei_ROI_table&#39;,
 &#39;nuclei&#39;,
 &#39;expected_table_FOV_ROI_table_1_True_0_0&#39;]
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># zyx pixel spacing in micrometers for pyramid levels</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="c1"># ... for images (channels, z, y, x)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">img</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">pyramid_level</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>[1, 1.0, 0.1625, 0.1625]
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># ... for labels (z, y, x)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">img</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">pyramid_level</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">label_name</span><span class="o">=</span><span class="s1">&#39;nuclei&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>[1.0, 0.65, 0.65]
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># tree of folder and file structure in the zarr group</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">/</span>
├── <span style="font-weight: bold">0</span> (1, 1, 2160, 5120) uint16
├── <span style="font-weight: bold">1</span> (1, 1, 1080, 2560) uint16
├── <span style="font-weight: bold">2</span> (1, 1, 540, 1280) uint16
├── <span style="font-weight: bold">3</span> (1, 1, 270, 640) uint16
├── <span style="font-weight: bold">4</span> (1, 1, 135, 320) uint16
├── <span style="font-weight: bold">labels</span>
│   ├── <span style="font-weight: bold">empty</span>
│   │   ├── <span style="font-weight: bold">0</span> (1, 540, 1280) uint32
│   │   ├── <span style="font-weight: bold">1</span> (1, 270, 640) uint32
│   │   ├── <span style="font-weight: bold">2</span> (1, 135, 320) uint32
│   │   ├── <span style="font-weight: bold">3</span> (1, 67, 160) uint32
│   │   └── <span style="font-weight: bold">4</span> (1, 33, 80) uint32
│   └── <span style="font-weight: bold">nuclei</span>
│       ├── <span style="font-weight: bold">0</span> (1, 540, 1280) uint32
│       ├── <span style="font-weight: bold">1</span> (1, 270, 640) uint32
│       ├── <span style="font-weight: bold">2</span> (1, 135, 320) uint32
│       ├── <span style="font-weight: bold">3</span> (1, 67, 160) uint32
│       └── <span style="font-weight: bold">4</span> (1, 33, 80) uint32
└── <span style="font-weight: bold">tables</span>
    ├── <span style="font-weight: bold">FOV_ROI_table</span>
    │   ├── <span style="font-weight: bold">X</span> (2, 8) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   └── <span style="font-weight: bold">FieldIndex</span> (2,) object
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (8,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    ├── <span style="font-weight: bold">expected_table_FOV_ROI_table_1_False_0_0</span>
    │   ├── <span style="font-weight: bold">X</span> (1504, 18) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   ├── <span style="font-weight: bold">ROI_name</span> (1504,) object
    │   │   ├── <span style="font-weight: bold">ROI_table_name</span> (1504,) object
    │   │   ├── <span style="font-weight: bold">_index</span> (1504,) int64
    │   │   └── <span style="font-weight: bold">label</span> (1504,) int64
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (18,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    ├── <span style="font-weight: bold">expected_table_FOV_ROI_table_1_True_0_0</span>
    │   ├── <span style="font-weight: bold">X</span> (1504, 38) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   ├── <span style="font-weight: bold">ROI_name</span> (1504,) object
    │   │   ├── <span style="font-weight: bold">ROI_table_name</span> (1504,) object
    │   │   ├── <span style="font-weight: bold">_index</span> (1504,) int64
    │   │   └── <span style="font-weight: bold">label</span> (1504,) int64
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (38,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    ├── <span style="font-weight: bold">expected_table_masked_nuclei_ROI_table_0_True_0_0</span>
    │   ├── <span style="font-weight: bold">X</span> (1493, 22) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   ├── <span style="font-weight: bold">ROI_label</span> (1493,) int64
    │   │   ├── <span style="font-weight: bold">ROI_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">ROI_table_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">_index</span> (1493,) int64
    │   │   └── <span style="font-weight: bold">label</span> (1493,) int64
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (22,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    ├── <span style="font-weight: bold">expected_table_masked_nuclei_ROI_table_1_True_0_0</span>
    │   ├── <span style="font-weight: bold">X</span> (1493, 38) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   ├── <span style="font-weight: bold">ROI_label</span> (1493,) int64
    │   │   ├── <span style="font-weight: bold">ROI_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">ROI_table_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">_index</span> (1493,) int64
    │   │   └── <span style="font-weight: bold">label</span> (1493,) int64
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (38,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    ├── <span style="font-weight: bold">expected_table_well_ROI_table_0_True_0_0</span>
    │   ├── <span style="font-weight: bold">X</span> (1493, 22) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   ├── <span style="font-weight: bold">ROI_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">ROI_table_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">_index</span> (1493,) int64
    │   │   └── <span style="font-weight: bold">label</span> (1493,) int64
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (22,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    ├── <span style="font-weight: bold">expected_table_well_ROI_table_3_False_0_0</span>
    │   ├── <span style="font-weight: bold">X</span> (1493, 50) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   ├── <span style="font-weight: bold">ROI_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">ROI_table_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">_index</span> (1493,) int64
    │   │   └── <span style="font-weight: bold">label</span> (1493,) int64
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (50,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    ├── <span style="font-weight: bold">expected_table_well_ROI_table_3_True_0_0</span>
    │   ├── <span style="font-weight: bold">X</span> (1493, 70) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   ├── <span style="font-weight: bold">ROI_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">ROI_table_name</span> (1493,) object
    │   │   ├── <span style="font-weight: bold">_index</span> (1493,) int64
    │   │   └── <span style="font-weight: bold">label</span> (1493,) int64
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (70,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    ├── <span style="font-weight: bold">nuclei</span>
    │   ├── <span style="font-weight: bold">X</span> (1493, 7) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   ├── <span style="font-weight: bold">_index</span> (1493,) int64
    │   │   └── <span style="font-weight: bold">label</span> (1493,) object
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (7,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    ├── <span style="font-weight: bold">nuclei_ROI_table</span>
    │   ├── <span style="font-weight: bold">X</span> (1493, 6) float32
    │   ├── <span style="font-weight: bold">layers</span>
    │   ├── <span style="font-weight: bold">obs</span>
    │   │   ├── <span style="font-weight: bold">_index</span> (1493,) object
    │   │   └── <span style="font-weight: bold">label</span> (1493,) object
    │   ├── <span style="font-weight: bold">obsm</span>
    │   ├── <span style="font-weight: bold">obsp</span>
    │   ├── <span style="font-weight: bold">uns</span>
    │   ├── <span style="font-weight: bold">var</span>
    │   │   └── <span style="font-weight: bold">_index</span> (6,) object
    │   ├── <span style="font-weight: bold">varm</span>
    │   └── <span style="font-weight: bold">varp</span>
    └── <span style="font-weight: bold">well_ROI_table</span>
        ├── <span style="font-weight: bold">X</span> (1, 6) float32
        ├── <span style="font-weight: bold">layers</span>
        ├── <span style="font-weight: bold">obs</span>
        │   └── <span style="font-weight: bold">FieldIndex</span> (1,) object
        ├── <span style="font-weight: bold">obsm</span>
        ├── <span style="font-weight: bold">obsp</span>
        ├── <span style="font-weight: bold">uns</span>
        ├── <span style="font-weight: bold">var</span>
        │   └── <span style="font-weight: bold">_index</span> (6,) object
        ├── <span style="font-weight: bold">varm</span>
        └── <span style="font-weight: bold">varp</span>
</pre>

<h2 id="extract-a-table-from-the-ome-zarr-image">Extract a table from the OME-Zarr image</h2>
<p>At the time of writing, tabular data is not yet covered in the NGFF
standard. The tables stored within this OME-Zarr image are formatted as
described in the <a href="https://fractal-analytics-platform.github.io/fractal-tasks-core/tables/">Fractal
documentation</a>.</p>
<p>As mentioned the goal of <code>ez_zarr</code> is to abstract the internal structure
and make it simple to obtain these tables as a <code>pandas.DataFrame</code> :</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">df</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;FOV_ROI_table&#39;</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">df</span>
</code></pre></div>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">FieldIndex</th>
<th style="text-align: right;">x_micrometer</th>
<th style="text-align: right;">y_micrometer</th>
<th style="text-align: right;">z_micrometer</th>
<th style="text-align: right;">len_x_micrometer</th>
<th style="text-align: right;">len_y_micrometer</th>
<th style="text-align: right;">len_z_micrometer</th>
<th style="text-align: right;">x_micrometer_original</th>
<th style="text-align: right;">y_micrometer_original</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">FOV_1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">416</td>
<td style="text-align: right;">351</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1448.3</td>
<td style="text-align: right;">-1517.7</td>
</tr>
<tr>
<td style="text-align: left;">FOV_2</td>
<td style="text-align: right;">416</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">416</td>
<td style="text-align: right;">351</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1032.3</td>
<td style="text-align: right;">-1517.7</td>
</tr>
</tbody>
</table>

<p>or <code>anndata.AnnData</code> object:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">ann</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;FOV_ROI_table&#39;</span><span class="p">,</span> <span class="n">as_AnnData</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">ann</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>AnnData object with n_obs × n_vars = 2 × 8
</code></pre></div>
<h2 id="visualize-the-image">Visualize the image</h2>
<p><code>get_array_by_coordinate()</code> extracts a rectangular region of interest
from an image by coordinates. If no coordinates or other arguments are
given, it returns the whole image at the lowest available resolution:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">arr</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_array_by_coordinate</span><span class="p">()</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># (ch, z, y, x)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>(1, 1, 135, 320)
</code></pre></div>
<p>Such an image array can be easily plotted using
<code>matplotlib.pyplot.imshow</code>:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">&#39;dark_background&#39;</span><span class="p">):</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">set_dpi</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-16-output-1.png" /></p>
<p>With <code>plot()</code>, <code>ome_zarr.Image</code> provides a convenient function for this
that automatically extracts the well image and plots it. Because it has
access to the image metadata, it can also add for example a scale bar:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">channels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>         <span class="n">channel_colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">],</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>         <span class="n">channel_ranges</span><span class="o">=</span><span class="p">[[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">]],</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>         <span class="n">title</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>         <span class="n">scalebar_micrometer</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>         <span class="n">scalebar_color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>         <span class="n">scalebar_position</span><span class="o">=</span><span class="s1">&#39;topleft&#39;</span><span class="p">,</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>         <span class="n">scalebar_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-17-output-1.png" /></p>
<p><code>plot()</code> uses internally <code>ez_zarr.plotting.plot_image()</code> which is a
convenient wrapper around <code>matplotlib.pyplot.imshow</code>. <code>plot_image()</code> can
also be used directly if you want to work with image arrays (for
examples, see section “Working with segmentation masks” below).</p>
<h2 id="zoom-in">Zoom in</h2>
<p>Let’s first show the coordinate axes for our image:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis_style</span><span class="o">=</span><span class="s1">&#39;micrometer&#39;</span><span class="p">,</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-18-output-1.png" /></p>
<p>Now we can zoom in by coordinates:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">upper_left_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>         <span class="n">lower_right_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>         <span class="n">scalebar_micrometer</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>         <span class="n">scalebar_color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-19-output-1.png" /></p>
<p>So far, we have been automatically using the lowest resolution pyramid
level version of the data, and the micrometer coordinates above have
been automatically converted to the corresponding pixel coordinates.</p>
<p>If we want to get the same image region at a higher resolution, we can
use the <code>pyramid_level</code> argument:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pyramid_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>         <span class="n">upper_left_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>         <span class="n">lower_right_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>         <span class="n">scalebar_micrometer</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>         <span class="n">scalebar_color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-20-output-1.png" /></p>
<p>You can see from the scale bar that again conversion from micrometer to
pixel coordinates are performed automatically.</p>
<p>If you prefer to work with pixel coordinates, for example for slicing
numpy arrays, <code>get_array_by_coordinate</code> or <code>plot</code> also support that.</p>
<p>Let’s first look at the full image at low resolution again, now using
pixel coordinates for the axes:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis_style</span><span class="o">=</span><span class="s1">&#39;pixel&#39;</span><span class="p">,</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-21-output-1.png" /></p>
<p>Now we zoom in using pixel coordinates (<code>coordinate_unit='pixel'</code>):</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coordinate_unit</span><span class="o">=</span><span class="s1">&#39;pixel&#39;</span><span class="p">,</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>         <span class="n">upper_left_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">56</span><span class="p">),</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>         <span class="n">lower_right_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">115</span><span class="p">,</span> <span class="mi">121</span><span class="p">),</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>         <span class="n">scalebar_micrometer</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>         <span class="n">scalebar_color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-22-output-1.png" /></p>
<p>Again, we were automatically using the lowest resolution of the image,
and we can use <code>pyramid_level</code> to select a higher resolution. When
working with pixel coordinates, we will need to specify that our
coordinates still refer to the currently selected <code>pyramid_level</code> (4),
in order to obtain the same region of the image. This can be done using
the <code>pyramid_level_coord</code> argument:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coordinate_unit</span><span class="o">=</span><span class="s1">&#39;pixel&#39;</span><span class="p">,</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>         <span class="n">pyramid_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>       <span class="c1"># extract image from this level</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>         <span class="n">pyramid_level_coord</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="c1"># coordinates refer to this level</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>         <span class="n">upper_left_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">56</span><span class="p">),</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>         <span class="n">lower_right_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">115</span><span class="p">,</span> <span class="mi">121</span><span class="p">),</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>         <span class="n">scalebar_micrometer</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>         <span class="n">scalebar_color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-23-output-1.png" /></p>
<h2 id="coordinate-conversions-usually-done-internally">Coordinate conversions (usually done internally)</h2>
<p>As mentioned the pixel coordinates depend on the <code>pyramid_level</code>. The
image metadata makes it easy to convert between pixel coordinates and
micrometer coordinates, or pixel coordinates referring to different
pyramid levels. The <code>get_array_by_coordinate</code> and <code>plot</code> methods do this
automatically.</p>
<p>You can do it also manually by using <code>get_scale</code> to obtain the pixel
sizes (in micrometer) from the image metadata, and
<code>ez_zarr.utils.convert_coordinates</code> to do the actual conversion:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># let&#39;s define some pixel coordinates referring to pyramid level 4</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">zyx_4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;starting coordinates (pixels in pyramid level 4): </span><span class="si">{</span><span class="n">zyx_4</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="c1"># get pixel scale at pyramid level 4 (z, y, x)</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="n">s_4</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">pyramid_level</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">spatial_axes_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pixel scale (pyramid level 4, micrometer): </span><span class="si">{</span><span class="n">s_4</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="c1"># convert from pyramid level 4 to 2</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="n">s_2</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">pyramid_level</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">spatial_axes_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pixel scale (pyramid level 2, micrometer): </span><span class="si">{</span><span class="n">s_2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="n">zyx_2</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_coordinates</span><span class="p">(</span><span class="n">coords_from</span><span class="o">=</span><span class="n">zyx_4</span><span class="p">,</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>                                  <span class="n">scale_from</span><span class="o">=</span><span class="n">s_4</span><span class="p">,</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>                                  <span class="n">scale_to</span><span class="o">=</span><span class="n">s_2</span><span class="p">)</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;starting coordinates converted to pyramid level 2 (pixel): </span><span class="si">{</span><span class="n">zyx_2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="c1"># convert from pixel to micrometers</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="c1"># remark: scales are in micrometer -&gt; the target scale is 1.0 for each axis</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="n">zyx_um</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_coordinates</span><span class="p">(</span><span class="n">coords_from</span><span class="o">=</span><span class="n">zyx_4</span><span class="p">,</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>                                   <span class="n">scale_from</span><span class="o">=</span><span class="n">s_4</span><span class="p">,</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>                                   <span class="n">scale_to</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;starting coordinates converted to micrometer: </span><span class="si">{</span><span class="n">zyx_um</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="c1"># convert back from micrometers to pixels</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="n">zyx_px</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_coordinates</span><span class="p">(</span><span class="n">coords_from</span><span class="o">=</span><span class="n">zyx_um</span><span class="p">,</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>                                   <span class="n">scale_from</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>                                   <span class="n">scale_to</span><span class="o">=</span><span class="n">s_4</span><span class="p">)</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;starting coordinates converted back to pixel (pyramid level 4): </span><span class="si">{</span><span class="n">zyx_px</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>starting coordinates (pixels in pyramid level 4): (1, 230, 180)
pixel scale (pyramid level 4, micrometer): [1.0, 2.6, 2.6]
pixel scale (pyramid level 2, micrometer): [1.0, 0.65, 0.65]
starting coordinates converted to pyramid level 2 (pixel): (1.0, 920.0, 720.0)
starting coordinates converted to micrometer: (1.0, 598.0, 468.0)
starting coordinates converted back to pixel (pyramid level 4): (1.0, 230.0, 180.0)
</code></pre></div>
<p>These functions are also used by <code>plot()</code> internally to add a scale bar
to the image plot, as we have seen above.</p>
<h2 id="working-with-segmentation-masks">Working with segmentation masks</h2>
<p>When segmentation masks (labels) are available, we can for example plot
them with transparency on top of the image, by selecting the desired
label using <code>label_name</code>:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label_name</span><span class="o">=</span><span class="s1">&#39;nuclei&#39;</span><span class="p">,</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>         <span class="n">pyramid_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>         <span class="n">upper_left_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>         <span class="n">lower_right_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>         <span class="n">scalebar_micrometer</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>         <span class="n">scalebar_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/ez_zarr/ome_zarr.py:944: UserWarning: For the requested pyramid level (0) of the intensity image, no matching label (&#39;nuclei&#39;) is available. Up-scaling the label using factor(s) [1. 4. 4.]
  warnings.warn(f&quot;For the requested pyramid level ({pyramid_level}) of the intensity image, no matching label (&#39;{lname}&#39;) is available. Up-scaling the label using factor(s) {scalefact_yx}&quot;)
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-25-output-2.png" /></p>
<p>You may notice that the above will warn about no labels being available
for the requested intensity image pyramid level. The <code>plot</code> method will
automatically use the label with the closest resolution and scale it to
match the intensity image.</p>
<p>For your convenience, it is also possible to specify multiple label
names using a <code>list</code> (for example to reuse the same label name list when
working with multiple images that have different labels). <code>plot()</code> will
still only display a single label mask, namely the first one in the
provided list that is available for the image (so the order of label
names matters):</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;whole_cells&#39;</span><span class="p">,</span> <span class="s1">&#39;nuclei&#39;</span><span class="p">,</span> <span class="s1">&#39;mitochondria&#39;</span><span class="p">],</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>         <span class="n">pyramid_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>         <span class="n">upper_left_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>         <span class="n">lower_right_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>         <span class="n">scalebar_micrometer</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>         <span class="n">scalebar_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>Using label_name=&#39;nuclei&#39; for image cardio-d14

/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/ez_zarr/ome_zarr.py:944: UserWarning: For the requested pyramid level (0) of the intensity image, no matching label (&#39;nuclei&#39;) is available. Up-scaling the label using factor(s) [1. 4. 4.]
  warnings.warn(f&quot;For the requested pyramid level ({pyramid_level}) of the intensity image, no matching label (&#39;{lname}&#39;) is available. Up-scaling the label using factor(s) {scalefact_yx}&quot;)
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-26-output-3.png" /></p>
<p>Using the <code>show_label_values</code> argument of <code>plotting.plot_image</code>, the
label values can be added (optionally also using the <code>label_fontsize</code>
and <code>label_text_colour</code> argument to ):</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">show_label_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>         <span class="n">label_fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>         <span class="n">label_text_colour</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>         <span class="n">label_name</span><span class="o">=</span><span class="s1">&#39;nuclei&#39;</span><span class="p">,</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>         <span class="n">pyramid_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>         <span class="n">upper_left_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>         <span class="n">lower_right_yx</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/ez_zarr/ome_zarr.py:944: UserWarning: For the requested pyramid level (0) of the intensity image, no matching label (&#39;nuclei&#39;) is available. Up-scaling the label using factor(s) [1. 4. 4.]
  warnings.warn(f&quot;For the requested pyramid level ({pyramid_level}) of the intensity image, no matching label (&#39;{lname}&#39;) is available. Up-scaling the label using factor(s) {scalefact_yx}&quot;)
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-27-output-2.png" /></p>
<p>If you are interested in a specific object, you can pass its value to
the <code>label_value</code> argument (and optionally use the <code>extend_pixels</code> and
<code>msk_alpha</code> arguments), to automatically select appropriate coordinates:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label_value</span><span class="o">=</span><span class="mi">877</span><span class="p">,</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>         <span class="n">extend_pixels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>         <span class="n">msk_alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>         <span class="n">show_label_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>         <span class="n">label_fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>         <span class="n">label_text_colour</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>         <span class="n">label_name</span><span class="o">=</span><span class="s1">&#39;nuclei&#39;</span><span class="p">,</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>         <span class="n">pyramid_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/ez_zarr/ome_zarr.py:944: UserWarning: For the requested pyramid level (0) of the intensity image, no matching label (&#39;nuclei&#39;) is available. Up-scaling the label using factor(s) [1. 4. 4.]
  warnings.warn(f&quot;For the requested pyramid level ({pyramid_level}) of the intensity image, no matching label (&#39;{lname}&#39;) is available. Up-scaling the label using factor(s) {scalefact_yx}&quot;)
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-28-output-2.png" /></p>
<p>For performance reasons, the bounding box for an object given by
<code>label_value</code> is calculated on the lowest-resolution label image by
default. This may lead to imprecise results, as here where the lower
part of object 877 is truncated. To improve the precision of the
bounding box calculation, you can manually select the pyramid level to
be used, using the argument <code>label_pyramid_level</code>:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label_value</span><span class="o">=</span><span class="mi">877</span><span class="p">,</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>         <span class="n">label_pyramid_level</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>         <span class="n">extend_pixels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>         <span class="n">msk_alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>         <span class="n">show_label_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>         <span class="n">label_fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>         <span class="n">label_text_colour</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>         <span class="n">label_name</span><span class="o">=</span><span class="s1">&#39;nuclei&#39;</span><span class="p">,</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>         <span class="n">pyramid_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/ez_zarr/ome_zarr.py:944: UserWarning: For the requested pyramid level (0) of the intensity image, no matching label (&#39;nuclei&#39;) is available. Up-scaling the label using factor(s) [1. 4. 4.]
  warnings.warn(f&quot;For the requested pyramid level ({pyramid_level}) of the intensity image, no matching label (&#39;{lname}&#39;) is available. Up-scaling the label using factor(s) {scalefact_yx}&quot;)
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-29-output-2.png" /></p>
<p>If you want to restrict the plot to the exact are within that specific
object (or objects), you can use the <code>restrict_to_label_values</code> argument
and provide a list of values:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">img</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label_value</span><span class="o">=</span><span class="mi">877</span><span class="p">,</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>         <span class="n">label_pyramid_level</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>         <span class="n">restrict_to_label_values</span><span class="o">=</span><span class="p">[</span><span class="mi">877</span><span class="p">,</span><span class="mi">914</span><span class="p">],</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>         <span class="n">extend_pixels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>         <span class="n">msk_alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>         <span class="n">show_label_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>         <span class="n">label_fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>         <span class="n">label_text_colour</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>         <span class="n">label_name</span><span class="o">=</span><span class="s1">&#39;nuclei&#39;</span><span class="p">,</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>         <span class="n">pyramid_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>         <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>         <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>         <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/ez_zarr/ome_zarr.py:944: UserWarning: For the requested pyramid level (0) of the intensity image, no matching label (&#39;nuclei&#39;) is available. Up-scaling the label using factor(s) [1. 4. 4.]
  warnings.warn(f&quot;For the requested pyramid level ({pyramid_level}) of the intensity image, no matching label (&#39;{lname}&#39;) is available. Up-scaling the label using factor(s) {scalefact_yx}&quot;)
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-30-output-2.png" /></p>
<h2 id="calculations-on-the-image-data">Calculations on the image data</h2>
<p>Let’s obtain again the intensity image data in the form of an array:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">arr</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_array_by_coordinate</span><span class="p">()</span>
</code></pre></div>
<p>To save memory, images are stored on disk and only loaded when needed
(for implementation details see the <a href="https://docs.dask.org/en/stable/array.html"><code>dask</code> Array
documentation</a>).</p>
<p>This can be demonstrated by <code>type(arr)</code> and <code>sys.getsizeof(arr)</code>:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># note that the image is an &#39;on-disk&#39; array</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>zarr.core.array.Array
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>56
</code></pre></div>
<p>To force loading of the data into memory as a <code>numpy</code> array, you can
call <code>np.array(arr)</code>:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">ndarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="c1"># triggers loading it into memory</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="nb">type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ndarr</span><span class="p">))</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>numpy.ndarray
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">ndarr</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>86560
</code></pre></div>
<p>In general, you can use <code>dask</code> arrays like <code>numpy</code> arrays. For example,
we can threshold the image:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># threshold (will also trigger loading into memory)</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">arr_mask</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">300</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="nb">type</span><span class="p">(</span><span class="n">arr_mask</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>numpy.ndarray
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># plot </span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">plotting</span><span class="o">.</span><span class="n">plot_image</span><span class="p">(</span><span class="n">im</span><span class="o">=</span><span class="n">arr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">msk</span><span class="o">=</span><span class="n">arr_mask</span><span class="p">,</span> <span class="n">msk_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>                    <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-37-output-1.png" /></p>
<p>This is of course not a recommended way to segment this image, but
rather meant to demonstrate that the <code>dask</code> arrays can be used just like
<code>numpy</code> arrays.</p>
<p>Extracting arrays and plotting them directly with <code>plotting.plot_image</code>
is also the recommended way to do more complex tasks that are not
directly supported by the arguments in <code>Image.plot</code>. For example, you
could subset a 3D image to select just one or several z-planes of
interest, instead of using the automated projection
(<code>z_projection_method</code> argument of <code>plotting.plot_image</code>).</p>
<h1 id="working-with-images-with-time-dimension">Working with images with time dimension</h1>
<p>Images that include a time dimension can also be handled using
<code>ez_zarr</code>. For plotting such images, you have to specify which time
index to plot.</p>
<p>For illustration, we first download a small example image (showing a
tubulin histone GFP coexpressing C. elegans embryo) that is part of the
<code>ez_zarr</code> GitHub repository. The original data set was acquired on a
multiphoton workstation by Josh Bembenek, and is freely available from
<a href="https://docs.openmicroscopy.org/ome-model/5.6.3/ome-tiff/data.html">openmicroscopy.org</a>.
The data set included in <code>ez_zarr</code> is a subset of the original image (2
timepoints, 1 channel, 2 z-planes). In addition, a manual segmentation
label was added for illustration purposes.</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># download an image with a time axis</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/fmicompbio/ez_zarr/archive/refs/heads/main.zip&quot;</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># raise an error if the request fails</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>    <span class="c1"># download</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>    <span class="n">temp_zip_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s1">&#39;temp.zip&#39;</span><span class="p">)</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_zip_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_zip</span><span class="p">:</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>        <span class="n">temp_zip</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>    <span class="c1"># unzip to current directory</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">temp_zip_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>        <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>    <span class="c1"># locate the extracted folder</span>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>    <span class="n">extracted_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;ez_zarr-main&quot;</span><span class="p">,</span> <span class="s2">&quot;tests&quot;</span><span class="p">,</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>                                    <span class="s2">&quot;example_data_5d&quot;</span><span class="p">)</span>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a>    <span class="c1"># move the image to current working directory</span>
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">extracted_folder</span><span class="p">):</span>
<a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">extracted_folder</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>Now we open the image:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">img5d</span> <span class="o">=</span> <span class="n">ome_zarr</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;tubhiswt4D_sub.zarr&quot;</span><span class="p">)</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">img5d</span><span class="o">.</span><span class="n">channel_info_image</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>&#39;tczyx&#39;
</code></pre></div>
<p>The time axis contains three entries:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">img5d</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">/</span>
├── <span style="font-weight: bold">0</span> (3, 1, 2, 512, 512) uint8
├── <span style="font-weight: bold">1</span> (3, 1, 2, 256, 256) uint8
├── <span style="font-weight: bold">2</span> (3, 1, 2, 128, 128) uint8
└── <span style="font-weight: bold">labels</span>
    └── <span style="font-weight: bold">embryo</span>
        ├── <span style="font-weight: bold">0</span> (3, 2, 512, 512) uint8
        ├── <span style="font-weight: bold">1</span> (3, 2, 256, 256) uint8
        └── <span style="font-weight: bold">2</span> (3, 2, 128, 128) uint8
</pre>

<p>We can plot selected timepoints by specifying the <code>time_index</code> argument
of <code>Image.plot()</code>:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">img5d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>           <span class="n">pyramid_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>           <span class="n">label_name</span><span class="o">=</span><span class="s2">&quot;embryo&quot;</span><span class="p">,</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>           <span class="n">fig_width_inch</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>           <span class="n">fig_height_inch</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>           <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-41-output-1.png" /></p>
<h1 id="working-with-multiple-images">Working with multiple images</h1>
<p>In some cases, you may want to handle a set of images, such as images
corresponding to the well of an high-content screening plate. Such data
is represented in <code>ez_zarr</code> by <code>ome_zarr.ImageList</code> objects, and can be
created from a folder containing multiple images using the
<code>ome_zarr.import_plate</code> function:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">img_directory</span> <span class="o">=</span> <span class="s1">&#39;20200812-CardiomyocyteDifferentiation14-Cycle1_mip.zarr&#39;</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">imgL</span> <span class="o">=</span> <span class="n">ome_zarr</span><span class="o">.</span><span class="n">import_plate</span><span class="p">(</span><span class="n">img_directory</span><span class="p">)</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">imgL</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at .DS_Store is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at empty_well_ROI_table_0_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at empty_well_ROI_table_1_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at empty_well_ROI_table_1_False_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_overwrite_True is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_well_ROI_table_3_False_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_FOV_ROI_table_1_False_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_well_ROI_table_3_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_masked_nuclei_ROI_table_0_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_masked_nuclei_ROI_table_1_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at empty_well_ROI_table_0_False_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_FOV_ROI_table_1_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_overwrite_False is not recognized as a component of a Zarr hierarchy.
  warnings.warn(
/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/zarr/core/group.py:3530: ZarrUserWarning: Object at table_well_ROI_table_0_True_0_0 is not recognized as a component of a Zarr hierarchy.
  warnings.warn(

ImageList of 1 images
  paths: 20200812-CardiomyocyteDifferentiation14-Cycle1_mip.zarr/B/03/0
  names: B03
</code></pre></div>
<p>Note that as our example data only contains a single well, this image
list contains only a single image.</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">imgL</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>1
</code></pre></div>
<p>All methods available to <code>ome_zarr.Image</code> can also be used for
<code>ome_zarr.ImageList</code> objects, and some have special behavior, for
example the plot method that arranges the wells in plate layout
(automatically determined to be compatible with the observed wells):</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">imgL</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-44-output-1.png" /></p>
<p>The detected layout can be returned as a <code>pandas.DataFrame</code>:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">imgL</span><span class="o">.</span><span class="n">get_layout</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">row_index</th>
<th data-quarto-table-cell-role="th">column_index</th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>

<p>… and also set manually:</p>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">layout_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;row_index&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;column_index&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">imgL</span><span class="o">.</span><span class="n">set_layout</span><span class="p">(</span><span class="n">layout_df</span><span class="p">)</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">imgL</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="../getting_started_Image_files/figure-markdown_strict/cell-46-output-1.png" /></p>
<h1 id="session-info">Session info</h1>
<div class="language-python highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kn">import</span> <span class="nn">session_info</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">session_info</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/session_info/main.py:213: UserWarning: The &#39;__version__&#39; attribute is deprecated and will be removed in MarkupSafe 3.1. Use feature detection, or `importlib.metadata.version(&quot;markupsafe&quot;)`, instead.
  mod_version = _find_version(mod.__version__)
</code></pre></div>
<details>
<summary>Click to view session information</summary>
<pre>
-----
anndata             0.12.2
ez_zarr             0.4.2
matplotlib          3.8.2
numpy               1.26.4
pandas              2.3.2
requests            2.32.5
session_info        1.0.0
skimage             0.22.0
zarr                3.1.3
-----
</pre>
<details>
<summary>Click to view modules imported as dependencies</summary>
<pre>
PIL                         11.3.0
anyio                       NA
arrow                       1.3.0
asttokens                   NA
attr                        25.3.0
attrs                       25.3.0
babel                       2.17.0
certifi                     2025.08.03
charset_normalizer          3.4.3
cloudpickle                 3.1.1
comm                        0.2.3
crc32c                      NA
cycler                      0.12.1
cython_runtime              NA
dask                        2025.9.1
dateutil                    2.9.0.post0
debugpy                     1.8.17
decorator                   5.2.1
defusedxml                  0.7.1
donfig                      0.8.1.post1
executing                   2.2.1
fastjsonschema              NA
fqdn                        NA
fsspec                      2025.9.0
h5py                        3.14.0
idna                        3.10
importlib_metadata          NA
ipykernel                   6.30.1
isoduration                 NA
jedi                        0.19.2
jinja2                      3.1.6
json5                       0.12.1
jsonpointer                 3.0.0
jsonschema                  4.25.1
jsonschema_specifications   NA
jupyter_events              0.12.0
jupyter_server              2.17.0
jupyterlab_server           2.27.3
kiwisolver                  1.4.9
lark                        1.2.2
lazy_loader                 0.4
legacy_api_wrap             NA
markupsafe                  3.0.2
matplotlib_inline           0.1.7
mpl_toolkits                NA
natsort                     8.4.0
nbformat                    5.10.4
numcodecs                   0.16.3
overrides                   NA
packaging                   25.0
parso                       0.8.5
platformdirs                4.4.0
prometheus_client           NA
prompt_toolkit              3.0.52
psutil                      7.1.0
pure_eval                   0.2.3
pydev_ipython               NA
pydevconsole                NA
pydevd                      3.2.3
pydevd_file_utils           NA
pydevd_plugins              NA
pydevd_tracing              NA
pygments                    2.19.2
pyparsing                   3.2.5
pythonjsonlogger            NA
pytz                        2025.2
referencing                 NA
rfc3339_validator           0.1.4
rfc3986_validator           0.1.1
rfc3987_syntax              NA
rich                        NA
rpds                        NA
scipy                       1.16.2
send2trash                  NA
six                         1.17.0
sniffio                     1.3.1
stack_data                  0.6.3
tabulate                    0.9.0
testing                     NA
tlz                         1.0.0
toolz                       1.0.0
tornado                     6.5.2
traitlets                   5.14.3
typing_extensions           NA
uri_template                NA
urllib3                     2.5.0
wcwidth                     0.2.13
webcolors                   NA
websocket                   1.8.0
yaml                        6.0.2
zipp                        NA
zmq                         27.1.0
zoneinfo                    NA
</pre>
</details> <!-- seems like this ends pre, so might as well be explicit -->
<pre>
-----
IPython             9.5.0
jupyter_client      8.6.3
jupyter_core        5.8.1
jupyterlab          4.4.7
notebook            7.4.5
-----
Python 3.11.13 (main, Jun  4 2025, 04:12:12) [GCC 13.3.0]
Linux-6.11.0-1018-azure-x86_64-with-glibc2.39
-----
Session information updated at 2025-09-22 12:38
</pre>
</details>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>